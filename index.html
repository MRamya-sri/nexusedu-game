<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusEdu - Learning Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            overflow-x: hidden;
        }
        
        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .bg-animation span {
            position: absolute;
            display: block;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            animation: move 25s infinite;
            bottom: -150px;
            border-radius: 50%;
        }
        
        .bg-animation span:nth-child(1) { left: 10%; width: 80px; height: 80px; animation-delay: 0s; }
        .bg-animation span:nth-child(2) { left: 20%; width: 30px; height: 30px; animation-delay: 2s; animation-duration: 12s; }
        .bg-animation span:nth-child(3) { left: 35%; width: 100px; height: 100px; animation-delay: 4s; }
        .bg-animation span:nth-child(4) { left: 50%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .bg-animation span:nth-child(5) { left: 65%; width: 40px; height: 40px; animation-delay: 0s; }
        .bg-animation span:nth-child(6) { left: 75%; width: 120px; height: 120px; animation-delay: 3s; }
        .bg-animation span:nth-child(7) { left: 85%; width: 25px; height: 25px; animation-delay: 7s; }
        .bg-animation span:nth-child(8) { left: 5%; width: 50px; height: 50px; animation-delay: 15s; animation-duration: 45s; }
        
        @keyframes move {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-1500px) rotate(720deg); opacity: 0; }
        }
        
        .container {
            max-width: 650px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6, #3498db);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 5s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .topic-title {
            color: #a0a0a0;
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 35px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Input Styles */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            color: #a0a0a0;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .input-box {
            width: 100%;
            padding: 18px 20px;
            font-size: 1.1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }
        
        .input-box:focus {
            outline: none;
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.3);
        }
        
        .input-box::placeholder { color: rgba(255, 255, 255, 0.4); }
        
        select.input-box {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 24px;
        }
        
        select.input-box option { background: #1a1a2e; }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before { left: 100%; }
        
        .btn-start {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.3);
        }
        
        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(46, 204, 113, 0.4);
        }
        
        .btn-next {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.3);
            display: none;
        }
        
        .btn-next.show { display: block; }
        
        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(155, 89, 182, 0.4);
        }
        
        /* Explanation Box */
        .explanation {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(155, 89, 182, 0.2));
            border-left: 4px solid #3498db;
            padding: 20px;
            border-radius: 0 16px 16px 0;
            margin-bottom: 25px;
        }
        
        .explanation h3 {
            color: #3498db;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .explanation p { color: #d0d0d0; line-height: 1.6; }
        
        /* Score Bar */
        .score-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .score-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .score-item small { color: #808080; font-size: 0.8rem; }
        
        .score-item span {
            display: block;
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 5px;
        }
        
        .score-item:nth-child(1) span { color: #3498db; }
        .score-item:nth-child(2) span { color: #2ecc71; }
        .score-item:nth-child(3) span { color: #f39c12; }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #9b59b6, #e74c3c);
            background-size: 200% 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* Question */
        .question-box {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .question-number {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            color: white;
        }
        
        .question-text {
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
            line-height: 1.5;
        }
        
        /* Options */
        .options {
            display: grid;
            gap: 12px;
        }
        
        .option-btn {
            padding: 18px 25px;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            color: white;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option-btn .option-letter {
            width: 35px;
            height: 35px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .option-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateX(10px);
        }
        
        .option-btn.correct {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
            animation: correctPulse 0.5s ease;
        }
        
        .option-btn.correct .option-letter {
            background: #2ecc71;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .option-btn.wrong {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            animation: shake 0.5s ease;
        }
        
        .option-btn.wrong .option-letter {
            background: #e74c3c;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .option-btn:disabled { cursor: not-allowed; opacity: 0.8; }
        
        /* Feedback */
        .feedback {
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            display: none;
            animation: slideUp 0.3s ease;
        }
        
        .feedback.show { display: block; }
        
        .feedback.correct {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.2));
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .feedback.wrong {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.2), rgba(192, 57, 43, 0.2));
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .feedback-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .feedback p { color: #d0d0d0; line-height: 1.5; }
        
        /* Streak */
        .streak-alert {
            text-align: center;
            padding: 15px;
            margin-top: 15px;
            border-radius: 16px;
            display: none;
            animation: streakPop 0.5s ease;
        }
        
        .streak-alert.show {
            display: block;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.2));
            border: 1px solid rgba(243, 156, 18, 0.3);
        }
        
        @keyframes streakPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
            display: none;
        }
        
        .loader {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #9b59b6;
            border-right-color: #3498db;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .loading p { color: #a0a0a0; font-size: 1.1rem; }
        .loading .loading-text { color: white; font-size: 1.3rem; margin-bottom: 10px; }
        
        /* Result */
        .result {
            text-align: center;
            display: none;
        }
        
        .result-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }
        
        .result h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .result .final-score {
            font-size: 4rem;
            font-weight: 700;
            color: #2ecc71;
            margin: 20px 0;
        }
        
        .result .message {
            color: #a0a0a0;
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-box small { color: #808080; }
        .stat-box span { display: block; font-size: 1.5rem; font-weight: 600; color: white; margin-top: 5px; }
        
        /* Mobile Responsive */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8rem; }
            .card { padding: 25px 20px; }
            .question-text { font-size: 1.2rem; }
            .option-btn { padding: 15px; font-size: 1rem; }
            .score-bar { grid-template-columns: repeat(3, 1fr); gap: 10px; }
            .score-item { padding: 10px; }
            .score-item span { font-size: 1.4rem; }
            .result .final-score { font-size: 3rem; }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üéì</div>
            <h1>NexusEdu</h1>
            <p class="topic-title" id="topic-title">Learn Anything, Anywhere!</p>
        </div>

        <!-- Setup Screen -->
        <div class="card" id="setup">
            <div class="input-group">
                <label>üìö What do you want to learn?</label>
                <input type="text" class="input-box" id="topic-input" placeholder="e.g., Prime Numbers, Photosynthesis, World War 2...">
            </div>
            <div class="input-group">
                <label>üéÇ Select your age group</label>
                <select class="input-box" id="age-select">
                    <option value="8">üßí Age 6-10 (Easy & Fun)</option>
                    <option value="12" selected>üìñ Age 11-14 (Medium)</option>
                    <option value="16">üéì Age 15-18 (Challenging)</option>
                </select>
            </div>
            <button class="btn btn-start" onclick="startGame()">üöÄ Start Learning Adventure!</button>
        </div>

        <!-- Loading Screen -->
        <div class="card loading" id="loading">
            <div class="loader"></div>
            <p class="loading-text">Creating your personalized quiz...</p>
            <p>AI is generating questions just for you! ‚ú®</p>
        </div>

        <!-- Game Screen -->
        <div class="card" id="game" style="display:none;">
            <div class="explanation" id="explain-box">
                <h3>üí° Quick Learn</h3>
                <p id="explanation"></p>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progress" style="width: 20%"></div>
            </div>
            
            <div class="score-bar">
                <div class="score-item">
                    <small>Question</small>
                    <span id="qnum">1/5</span>
                </div>
                <div class="score-item">
                    <small>Score</small>
                    <span id="score">0</span>
                </div>
                <div class="score-item">
                    <small>Streak</small>
                    <span id="streak">0 üî•</span>
                </div>
            </div>
            
            <div class="question-box">
                <div class="question-number" id="q-badge">Question 1</div>
                <p class="question-text" id="question"></p>
            </div>
            
            <div class="options" id="options"></div>
            
            <div class="feedback" id="feedback">
                <div class="feedback-icon" id="feedback-icon"></div>
                <p id="feedback-text"></p>
            </div>
            
            <div class="streak-alert" id="streak-alert"></div>
            
            <button class="btn btn-next" id="next-btn" onclick="nextQ()">Next Question ‚Üí</button>
        </div>

        <!-- Result Screen -->
        <div class="card result" id="result">
            <div class="result-icon" id="result-icon">üèÜ</div>
            <h2>Adventure Complete!</h2>
            <p class="final-score" id="final-score">0/5</p>
            <p class="message" id="message"></p>
            
            <div class="result-stats">
                <div class="stat-box">
                    <small>Best Streak</small>
                    <span id="best-streak">0 üî•</span>
                </div>
                <div class="stat-box">
                    <small>Accuracy</small>
                    <span id="accuracy">0%</span>
                </div>
            </div>
            
            <button class="btn btn-start" onclick="reset()">üîÑ Play Again</button>
        </div>
    </div>

    <script>
        let data, qIndex = 0, score = 0, streakCount = 0, bestStreak = 0;
        
        // YOUR N8N WEBHOOK URL - Replace this!
        const WEBHOOK_URL = 'YOUR_N8N_WEBHOOK_URL';

        // Check URL params
        const params = new URLSearchParams(window.location.search);
        if (params.get('topic')) {
            document.getElementById('topic-input').value = decodeURIComponent(params.get('topic'));
            if (params.get('age')) document.getElementById('age-select').value = params.get('age');
        }

        async function startGame() {
            const topic = document.getElementById('topic-input').value.trim();
            const age = document.getElementById('age-select').value;
            if (!topic) return alert('Please enter a topic!');
            
            document.getElementById('topic-title').textContent = topic;
            document.getElementById('setup').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                // Try to fetch from n8n webhook
                if (WEBHOOK_URL !== 'YOUR_N8N_WEBHOOK_URL') {
                    const response = await fetch(`${WEBHOOK_URL}?topic=${encodeURIComponent(topic)}&age=${age}`);
                    data = await response.json();
                } else {
                    // Use backup questions
                    data = getBackupQuiz(topic, age);
                }
                
                qIndex = 0;
                score = 0;
                streakCount = 0;
                bestStreak = 0;
                
                // Shuffle and pick 5 questions
                if (data.questions.length > 5) {
                    data.questions = shuffleArray(data.questions).slice(0, 5);
                }
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                document.getElementById('explanation').textContent = data.explanation;
                showQ();
            } catch (error) {
                console.error(error);
                data = getBackupQuiz(topic, age);
                qIndex = 0;
                score = 0;
                streakCount = 0;
                bestStreak = 0;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                document.getElementById('explanation').textContent = data.explanation;
                showQ();
            }
        }

        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function getBackupQuiz(topic, age) {
            const quizzes = {
                'prime numbers': {
                    explanation: 'Prime numbers are numbers greater than 1 that have exactly two factors: 1 and themselves. Examples include 2, 3, 5, 7, 11, 13, 17, 19, 23...',
                    questions: [
                        { q: 'Which of these is a prime number?', opts: ['4', '7', '9', '15'], ans: 1, tip: '7 has only two factors: 1 and 7!' },
                        { q: 'What is the only even prime number?', opts: ['0', '1', '2', '4'], ans: 2, tip: '2 is the only even prime! All other even numbers are divisible by 2.' },
                        { q: 'Why is 1 NOT a prime number?', opts: ['It is too small', 'It has only one factor', 'It is odd', 'It is negative'], ans: 1, tip: 'Primes must have exactly TWO factors. 1 only has one factor (itself).' },
                        { q: 'Which number is NOT prime?', opts: ['23', '29', '27', '31'], ans: 2, tip: '27 = 3 √ó 9. It has factors other than 1 and itself!' },
                        { q: 'How many prime numbers are between 10 and 20?', opts: ['2', '3', '4', '5'], ans: 2, tip: 'The primes are: 11, 13, 17, 19 = 4 primes!' }
                    ]
                },
                'fractions': {
                    explanation: 'Fractions represent parts of a whole. The numerator (top) shows how many parts you have, the denominator (bottom) shows total equal parts.',
                    questions: [
                        { q: 'What is 1/4 + 1/4?', opts: ['1/8', '2/8', '1/2', '2/4'], ans: 2, tip: '1/4 + 1/4 = 2/4 = 1/2!' },
                        { q: 'Which fraction equals 2/4?', opts: ['1/4', '1/2', '3/4', '2/8'], ans: 1, tip: '2/4 simplified = 1/2!' },
                        { q: 'Which is greater: 3/4 or 2/3?', opts: ['3/4', '2/3', 'Equal', 'Cannot compare'], ans: 0, tip: '3/4 = 0.75, 2/3 = 0.67. So 3/4 is greater!' },
                        { q: 'What is 1/2 √ó 1/3?', opts: ['1/5', '1/6', '2/5', '2/6'], ans: 1, tip: '1√ó1=1, 2√ó3=6. Answer: 1/6!' },
                        { q: 'What is 3/4 of 20?', opts: ['10', '12', '15', '18'], ans: 2, tip: '3/4 √ó 20 = 60/4 = 15!' }
                    ]
                },
                'photosynthesis': {
                    explanation: 'Photosynthesis is how plants make food using sunlight, water, and carbon dioxide. It happens in chloroplasts and produces glucose and oxygen.',
                    questions: [
                        { q: 'What gas do plants release during photosynthesis?', opts: ['Carbon dioxide', 'Nitrogen', 'Oxygen', 'Hydrogen'], ans: 2, tip: 'Plants release oxygen as a byproduct!' },
                        { q: 'Where does photosynthesis happen?', opts: ['Nucleus', 'Mitochondria', 'Chloroplast', 'Cell wall'], ans: 2, tip: 'Chloroplasts contain chlorophyll!' },
                        { q: 'What pigment makes plants green?', opts: ['Melanin', 'Chlorophyll', 'Carotene', 'Xanthophyll'], ans: 1, tip: 'Chlorophyll absorbs red and blue, reflects green!' },
                        { q: 'Which is NOT needed for photosynthesis?', opts: ['Sunlight', 'Water', 'Oxygen', 'Carbon dioxide'], ans: 2, tip: 'Oxygen is produced, not needed!' },
                        { q: 'What is the main product of photosynthesis?', opts: ['Protein', 'Glucose', 'Fat', 'Starch'], ans: 1, tip: 'Glucose (sugar) is the main food produced!' }
                    ]
                }
            };

            const key = topic.toLowerCase().trim();
            if (quizzes[key]) return JSON.parse(JSON.stringify(quizzes[key]));
            
            for (let k in quizzes) {
                if (key.includes(k) || k.includes(key)) {
                    return JSON.parse(JSON.stringify(quizzes[k]));
                }
            }

            return {
                explanation: `Let's explore ${topic}! This quiz will test your knowledge and help you learn more.`,
                questions: [
                    { q: `What's the best way to learn ${topic}?`, opts: ['Memorize everything', 'Understand concepts', 'Skip basics', 'Read once'], ans: 1, tip: 'Understanding concepts is more effective!' },
                    { q: `When studying ${topic}, you should:`, opts: ['Rush through', 'Take notes & practice', 'Avoid questions', 'Only before tests'], ans: 1, tip: 'Notes and practice lead to better understanding!' },
                    { q: `${topic} connects to:`, opts: ['Nothing', 'Only itself', 'Many subjects', 'Only advanced topics'], ans: 2, tip: 'All knowledge is interconnected!' },
                    { q: `Best way to remember ${topic}?`, opts: ['Cram before test', 'Review regularly', 'Read once', 'Copy others'], ans: 1, tip: 'Spaced repetition helps memory!' },
                    { q: `If ${topic} is difficult, you should:`, opts: ['Give up', 'Break into parts', 'Blame teacher', 'Skip it'], ans: 1, tip: 'Breaking into chunks makes it manageable!' }
                ]
            };
        }

        function showQ() {
            const q = data.questions[qIndex];
            const progress = ((qIndex + 1) / 5) * 100;
            
            document.getElementById('progress').style.width = `${progress}%`;
            document.getElementById('qnum').textContent = `${qIndex + 1}/5`;
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = `${streakCount} üî•`;
            document.getElementById('q-badge').textContent = `Question ${qIndex + 1}`;
            document.getElementById('question').textContent = q.q;
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('next-btn').className = 'btn btn-next';
            document.getElementById('streak-alert').className = 'streak-alert';

            const letters = ['A', 'B', 'C', 'D'];
            const opts = document.getElementById('options');
            opts.innerHTML = '';
            
            q.opts.forEach((o, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `<span class="option-letter">${letters[i]}</span><span>${o}</span>`;
                btn.onclick = () => check(i);
                opts.appendChild(btn);
            });
        }

        function check(i) {
            const q = data.questions[qIndex];
            const btns = document.querySelectorAll('.option-btn');
            const fb = document.getElementById('feedback');
            const fbIcon = document.getElementById('feedback-icon');
            const fbText = document.getElementById('feedback-text');
            const streakAlert = document.getElementById('streak-alert');

            btns.forEach((b, idx) => {
                b.disabled = true;
                if (idx === q.ans) b.classList.add('correct');
                if (idx === i && i !== q.ans) b.classList.add('wrong');
            });

            if (i === q.ans) {
                score++;
                streakCount++;
                if (streakCount > bestStreak) bestStreak = streakCount;
                
                fbIcon.textContent = '‚úÖ';
                fbText.textContent = q.tip;
                fb.className = 'feedback show correct';
                
                if (streakCount >= 3) {
                    streakAlert.textContent = streakCount >= 5 ? 'üî• UNSTOPPABLE! ' + streakCount + ' in a row!' : 'üî• Hot streak! ' + streakCount + ' correct!';
                    streakAlert.className = 'streak-alert show';
                }
            } else {
                streakCount = 0;
                fbIcon.textContent = '‚ùå';
                fbText.textContent = q.tip;
                fb.className = 'feedback show wrong';
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = `${streakCount} üî•`;
            document.getElementById('next-btn').className = 'btn btn-next show';
        }

        function nextQ() {
            qIndex++;
            if (qIndex < 5) showQ();
            else endGame();
        }

        function endGame() {
            document.getElementById('game').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            document.getElementById('final-score').textContent = `${score}/5`;
            document.getElementById('best-streak').textContent = `${bestStreak} üî•`;
            document.getElementById('accuracy').textContent = `${(score/5*100).toFixed(0)}%`;
            
            const icon = document.getElementById('result-icon');
            const msg = document.getElementById('message');
            
            if (score === 5) {
                icon.textContent = 'üèÜ';
                msg.textContent = 'Perfect Score! You are a true master!';
            } else if (score >= 4) {
                icon.textContent = 'üåü';
                msg.textContent = 'Excellent! Almost perfect!';
            } else if (score >= 3) {
                icon.textContent = 'üëç';
                msg.textContent = 'Good job! Keep practicing!';
            } else if (score >= 2) {
                icon.textContent = 'üìö';
                msg.textContent = 'Not bad! Review and try again!';
            } else {
                icon.textContent = 'üí™';
                msg.textContent = 'Keep learning! You will improve!';
            }
        }

        function reset() {
            document.getElementById('result').style.display = 'none';
            document.getElementById('setup').style.display = 'block';
            document.getElementById('topic-input').value = '';
        }
    </script>
</body>
</html>
