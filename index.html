<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusEdu - Learning Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-size: 2rem;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .topic-display {
            text-align: center;
            color: #3498db;
            font-size: 1.3rem;
            margin-bottom: 20px;
        }
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .explanation {
            background: rgba(52,152,219,0.2);
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }
        .score-bar {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .score-item {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
        }
        .score-item span { font-size: 1.5rem; color: #f39c12; font-weight: bold; }
        .question { font-size: 1.3rem; margin-bottom: 20px; text-align: center; }
        .options { display: grid; gap: 10px; }
        .option-btn {
            padding: 15px;
            font-size: 1rem;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }
        .option-btn:hover { background: rgba(255,255,255,0.2); }
        .option-btn.correct { background: rgba(46,204,113,0.5); border-color: #2ecc71; }
        .option-btn.wrong { background: rgba(231,76,60,0.5); border-color: #e74c3c; }
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
            text-align: center;
        }
        .feedback.show { display: block; }
        .next-btn {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            display: none;
        }
        .next-btn.show { display: block; }
        .input-box {
            width: 100%;
            padding: 15px;
            font-size: 1rem;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            margin-bottom: 15px;
        }
        .input-box::placeholder { color: rgba(255,255,255,0.5); }
        .start-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
        }
        .result { text-align: center; display: none; }
        .result h2 { color: #f39c12; font-size: 2rem; margin-bottom: 20px; }
        .result .final-score { font-size: 3rem; color: #2ecc71; font-weight: bold; }
        .loading { text-align: center; padding: 40px; display: none; }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ NexusEdu Game</h1>
        <p class="topic-display" id="topic-display">Learn Any Topic!</p>

        <!-- Setup -->
        <div class="card" id="setup">
            <input type="text" class="input-box" id="topic-input" placeholder="Enter topic (e.g., Prime Numbers, Fractions)">
            <select class="input-box" id="age-select">
                <option value="8">Age 6-10 (Easy)</option>
                <option value="12" selected>Age 11-14 (Medium)</option>
                <option value="16">Age 15-18 (Hard)</option>
            </select>
            <button class="start-btn" onclick="startGame()">üöÄ Start Game!</button>
        </div>

        <!-- Loading -->
        <div class="card loading" id="loading">
            <div class="spinner"></div>
            <p>Creating your game...</p>
        </div>

        <!-- Game -->
        <div class="card" id="game" style="display:none;">
            <div class="explanation" id="explain-box">
                <strong>üí° Quick Learn:</strong>
                <p id="explanation"></p>
            </div>
            <div class="score-bar">
                <div class="score-item"><small>Question</small><span id="qnum">1/5</span></div>
                <div class="score-item"><small>Score</small><span id="score">0</span></div>
            </div>
            <p class="question" id="question"></p>
            <div class="options" id="options"></div>
            <div class="feedback" id="feedback"></div>
            <button class="next-btn" id="next-btn" onclick="nextQ()">Next ‚Üí</button>
        </div>

        <!-- Result -->
        <div class="card result" id="result">
            <h2>üéâ Complete!</h2>
            <p class="final-score" id="final-score">0/5</p>
            <p id="message" style="margin:20px 0;color:#aaa;"></p>
            <button class="start-btn" onclick="reset()">üîÑ Play Again</button>
        </div>
    </div>

    <script>
        let data, qIndex = 0, score = 0;

        // üîë YOUR OPENROUTER API KEY
        const API_KEY = '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';

        // Check URL params
        const params = new URLSearchParams(window.location.search);
        if (params.get('topic')) {
            document.getElementById('topic-input').value = params.get('topic');
            if (params.get('age')) document.getElementById('age-select').value = params.get('age');
        }

        async function startGame() {
            const topic = document.getElementById('topic-input').value.trim();
            const age = document.getElementById('age-select').value;
            if (!topic) return alert('Enter a topic!');
            
            document.getElementById('topic-display').textContent = topic;
            document.getElementById('setup').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                data = await generateQuizFromAI(topic, age);
                qIndex = 0;
                score = 0;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                document.getElementById('explanation').textContent = data.explanation;
                showQ();
            } catch (error) {
                console.error(error);
                alert('Error generating quiz. Using backup questions.');
                data = generateBackupQuiz(topic);
                qIndex = 0;
                score = 0;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                document.getElementById('explanation').textContent = data.explanation;
                showQ();
            }
        }

        async function generateQuizFromAI(topic, age) {
            const ageGroup = age <= 10 ? "6-10 year old child" : age <= 14 ? "11-14 year old student" : "15-18 year old student";
            
            const prompt = `Create an educational quiz about "${topic}" for a ${ageGroup}.

Return ONLY valid JSON with no extra text:
{
    "explanation": "2-3 sentence simple explanation of ${topic}",
    "questions": [
        {
            "q": "Actual question about ${topic}",
            "opts": ["Option A", "Option B", "Option C", "Option D"],
            "ans": 0,
            "tip": "Why the correct answer is right"
        }
    ]
}

Requirements:
- Create exactly 5 real questions testing knowledge of ${topic}
- Questions should be age-appropriate for ${ageGroup}
- Include actual facts and concepts about ${topic}
- "ans" is the index (0-3) of the correct option
- Make questions progressively harder
- For Prime Numbers: ask about identifying primes, properties, examples
- For Fractions: ask about operations, simplifying, comparing
- For any topic: ask real conceptual questions, not generic ones`;

            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: 'meta-llama/llama-3.1-8b-instruct:free',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 1500
                })
            });

            const result = await response.json();
            const content = result.choices[0].message.content;
            
            // Extract JSON from response
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                return JSON.parse(jsonMatch[0]);
            }
            throw new Error('Could not parse AI response');
        }

        function generateBackupQuiz(topic) {
            // Backup questions for common topics
            const quizzes = {
                'prime numbers': {
                    explanation: 'Prime numbers are numbers greater than 1 that can only be divided by 1 and themselves. Examples: 2, 3, 5, 7, 11.',
                    questions: [
                        { q: 'Which of these is a prime number?', opts: ['4', '7', '9', '12'], ans: 1, tip: '7 can only be divided by 1 and 7!' },
                        { q: 'What is the smallest prime number?', opts: ['0', '1', '2', '3'], ans: 2, tip: '2 is the smallest and only even prime!' },
                        { q: 'Is 15 a prime number?', opts: ['Yes', 'No, divisible by 3 and 5', 'No, divisible by 2', 'Cannot determine'], ans: 1, tip: '15 = 3 √ó 5, so not prime!' },
                        { q: 'How many prime numbers are between 1 and 10?', opts: ['2', '3', '4', '5'], ans: 2, tip: 'They are: 2, 3, 5, 7 = 4 primes!' },
                        { q: 'Which is NOT a prime number?', opts: ['11', '13', '21', '17'], ans: 2, tip: '21 = 3 √ó 7, so not prime!' }
                    ]
                },
                'fractions': {
                    explanation: 'Fractions represent parts of a whole. The top number (numerator) shows parts we have, bottom (denominator) shows total parts.',
                    questions: [
                        { q: 'What is 1/2 + 1/2?', opts: ['1/4', '2/4', '1', '2'], ans: 2, tip: 'Two halves make a whole = 1!' },
                        { q: 'Which fraction is larger: 1/3 or 1/4?', opts: ['1/3', '1/4', 'They are equal', 'Cannot compare'], ans: 0, tip: 'Smaller denominator = larger fraction!' },
                        { q: 'Simplify 4/8', opts: ['1/4', '2/4', '1/2', '4/8'], ans: 2, tip: 'Divide both by 4: 4√∑4/8√∑4 = 1/2!' },
                        { q: 'What is 3/4 of 8?', opts: ['4', '6', '8', '12'], ans: 1, tip: '8 √ó 3/4 = 24/4 = 6!' },
                        { q: 'Convert 0.5 to a fraction', opts: ['1/5', '5/10', '1/2', '5/1'], ans: 2, tip: '0.5 = 5/10 = 1/2!' }
                    ]
                }
            };

            const key = topic.toLowerCase();
            if (quizzes[key]) return quizzes[key];

            // Generic backup
            return {
                explanation: `${topic} is an important concept to learn. Let's test your understanding!`,
                questions: [
                    { q: `What is the main purpose of learning ${topic}?`, opts: ['To understand the world better', 'No purpose', 'Just for exams', 'To waste time'], ans: 0, tip: 'Learning helps us understand!' },
                    { q: `${topic} is best learned by:`, opts: ['Ignoring it', 'Practice and examples', 'Memorizing without understanding', 'Guessing'], ans: 1, tip: 'Practice makes perfect!' },
                    { q: `Why is ${topic} taught in schools?`, opts: ['It has no use', 'It builds foundational knowledge', 'Teachers like it', 'Random reason'], ans: 1, tip: 'Foundation is key!' },
                    { q: `When facing a difficult part of ${topic}, you should:`, opts: ['Give up', 'Ask for help and practice more', 'Skip it forever', 'Complain'], ans: 1, tip: 'Asking for help is smart!' },
                    { q: `${topic} connects to:`, opts: ['Nothing', 'Other subjects and real life', 'Only this subject', 'Video games only'], ans: 1, tip: 'Everything connects!' }
                ]
            };
        }

        function showQ() {
            const q = data.questions[qIndex];
            document.getElementById('qnum').textContent = `${qIndex + 1}/5`;
            document.getElementById('score').textContent = score;
            document.getElementById('question').textContent = q.q;
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('next-btn').className = 'next-btn';

            const opts = document.getElementById('options');
            opts.innerHTML = '';
            q.opts.forEach((o, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = o;
                btn.onclick = () => check(i);
                opts.appendChild(btn);
            });
        }

        function check(i) {
            const q = data.questions[qIndex];
            const btns = document.querySelectorAll('.option-btn');
            const fb = document.getElementById('feedback');

            btns.forEach((b, idx) => {
                b.disabled = true;
                if (idx === q.ans) b.classList.add('correct');
                if (idx === i && i !== q.ans) b.classList.add('wrong');
            });

            if (i === q.ans) {
                score++;
                fb.textContent = '‚úÖ Correct! ' + q.tip;
                fb.style.background = 'rgba(46,204,113,0.3)';
            } else {
                fb.textContent = '‚ùå Wrong. ' + q.tip;
                fb.style.background = 'rgba(231,76,60,0.3)';
            }
            fb.className = 'feedback show';
            document.getElementById('score').textContent = score;
            document.getElementById('next-btn').className = 'next-btn show';
        }

        function nextQ() {
            qIndex++;
            if (qIndex < 5) showQ();
            else endGame();
        }

        function endGame() {
            document.getElementById('game').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            document.getElementById('final-score').textContent = `${score}/5`;
            const msg = score === 5 ? 'üèÜ Perfect!' : score >= 3 ? 'üëç Good job!' : 'üí™ Keep trying!';
            document.getElementById('message').textContent = msg;
        }

        function reset() {
            document.getElementById('result').style.display = 'none';
            document.getElementById('setup').style.display = 'block';
        }
    </script>
</body>
</html>
