<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexusEdu - Learn with Games</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 700px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .concept-title {
            color: #3498db;
            font-size: 1.5rem;
            margin-top: 10px;
        }
        
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .explanation {
            background: rgba(52, 152, 219, 0.2);
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }
        
        .explanation h3 { color: #3498db; margin-bottom: 10px; }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .score-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .score-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .score-item span {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f39c12;
        }
        
        .question-box {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .question-text {
            font-size: 1.4rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .option-btn {
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .option-btn:hover {
            background: rgba(255,255,255,0.15);
            transform: scale(1.02);
        }
        
        .option-btn.correct {
            background: rgba(46, 204, 113, 0.4);
            border-color: #2ecc71;
        }
        
        .option-btn.wrong {
            background: rgba(231, 76, 60, 0.4);
            border-color: #e74c3c;
        }
        
        .option-btn:disabled { cursor: not-allowed; opacity: 0.7; }
        
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }
        
        .feedback.show { display: block; }
        .feedback.correct { background: rgba(46,204,113,0.2); border: 1px solid #2ecc71; }
        .feedback.wrong { background: rgba(231,76,60,0.2); border: 1px solid #e74c3c; }
        
        .next-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            margin-top: 15px;
            display: none;
        }
        
        .next-btn.show { display: block; }
        .next-btn:hover { transform: scale(1.02); }
        
        .result-screen {
            text-align: center;
            display: none;
        }
        
        .result-screen h2 {
            font-size: 2.5rem;
            color: #f39c12;
            margin-bottom: 20px;
        }
        
        .result-score {
            font-size: 4rem;
            font-weight: bold;
            color: #2ecc71;
            margin-bottom: 20px;
        }
        
        .result-message { color: #a0a0a0; margin-bottom: 30px; }
        
        .restart-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
        }
        
        .topic-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
            margin-bottom: 15px;
        }
        
        .topic-input::placeholder { color: rgba(255,255,255,0.5); }
        
        .start-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
        }
        
        .start-btn:hover { transform: scale(1.02); }
        .start-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        
        .age-select {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
            margin-bottom: 15px;
        }
        
        .age-select option { background: #1a1a2e; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ NexusEdu Learning Game</h1>
            <p class="concept-title" id="concept-title">Learn Any Concept!</p>
        </div>
        
        <!-- Setup Screen -->
        <div class="card" id="setup-screen">
            <h3 style="margin-bottom: 20px; text-align: center;">What do you want to learn?</h3>
            
            <input type="text" class="topic-input" id="topic-input" 
                   placeholder="e.g., Prime Numbers, Fractions, Photosynthesis, WW2...">
            
            <select class="age-select" id="age-select">
                <option value="8">Age 6-10 (Fun & Simple)</option>
                <option value="12" selected>Age 11-14 (Puzzles & Discovery)</option>
                <option value="16">Age 15-18 (Detailed & Challenging)</option>
            </select>
            
            <button class="start-btn" id="start-btn" onclick="startGame()">
                üöÄ Generate Game!
            </button>
        </div>
        
        <!-- Loading Screen -->
        <div class="card loading" id="loading-screen" style="display: none;">
            <div class="spinner"></div>
            <p>üß† AI is creating your personalized game...</p>
            <p style="color: #a0a0a0; margin-top: 10px; font-size: 0.9rem;">
                Generating questions, explanations & fun facts!
            </p>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" style="display: none;">
            <div class="card">
                <div class="explanation" id="explanation-box">
                    <h3>üí° Quick Learn</h3>
                    <p id="explanation-text">Loading explanation...</p>
                </div>
                
                <div class="score-bar">
                    <div class="score-item">
                        <small>Question</small>
                        <span id="q-num">1/5</span>
                    </div>
                    <div class="score-item">
                        <small>Score</small>
                        <span id="score">0</span>
                    </div>
                    <div class="score-item">
                        <small>Streak</small>
                        <span id="streak">0üî•</span>
                    </div>
                </div>
                
                <div class="question-box">
                    <p class="question-text" id="question-text">Loading question...</p>
                    <div class="options" id="options-container"></div>
                    <div class="feedback" id="feedback"></div>
                    <button class="next-btn" id="next-btn" onclick="nextQuestion()">Next Question ‚Üí</button>
                </div>
            </div>
        </div>
        
        <!-- Result Screen -->
        <div class="card result-screen" id="result-screen">
            <h2>üéâ Game Complete!</h2>
            <div class="result-score" id="final-score">0/5</div>
            <p class="result-message" id="result-message">Great job learning!</p>
            <button class="restart-btn" onclick="resetGame()">üîÑ Learn Something New</button>
        </div>
    </div>

    <script>
        let gameData = null;
        let currentQ = 0;
        let score = 0;
        let streak = 0;
        
        // Check URL for topic parameter
        const urlParams = new URLSearchParams(window.location.search);
        const urlTopic = urlParams.get('topic');
        const urlAge = urlParams.get('age');
        
        if (urlTopic) {
            document.getElementById('topic-input').value = urlTopic;
            if (urlAge) document.getElementById('age-select').value = urlAge;
            // Auto-start if topic provided in URL
            setTimeout(startGame, 500);
        }
        
        async function startGame() {
            const topic = document.getElementById('topic-input').value.trim();
            const age = document.getElementById('age-select').value;
            
            if (!topic) {
                alert('Please enter a topic!');
                return;
            }
            
            document.getElementById('concept-title').textContent = topic;
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('loading-screen').style.display = 'block';
            
            try {
                gameData = await generateGameContent(topic, age);
                currentQ = 0;
                score = 0;
                streak = 0;
                
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                document.getElementById('explanation-text').textContent = gameData.explanation;
                
                showQuestion();
            } catch (error) {
                console.error(error);
                alert('Error generating game. Please try again!');
                resetGame();
            }
        }
        
        async function generateGameContent(topic, age) {
            // For demo - using mock data
            // In production, replace with actual API call to OpenRouter
            
            const ageDescriptor = age <= 10 ? "a young child (6-10 years)" : 
                                  age <= 14 ? "a middle schooler (11-14 years)" : 
                                  "a high school student (15-18 years)";
            
            const prompt = `Create an educational game about "${topic}" for ${ageDescriptor}.
            
            Return ONLY valid JSON (no markdown, no explanation):
            {
                "explanation": "Brief 2-3 sentence explanation of the topic",
                "questions": [
                    {
                        "question": "Question text",
                        "options": ["Option A", "Option B", "Option C", "Option D"],
                        "correct": 0,
                        "explanation": "Why this answer is correct"
                    }
                ]
            }
            
            Create exactly 5 questions. Make them fun and age-appropriate.`;
            
            // Try API call first
            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Bearer YOUR_OPENROUTER_API_KEY"
                    },
                    body: JSON.stringify({
                        model: "meta-llama/llama-3.1-8b-instruct:free",
                        messages: [{ role: "user", content: prompt }],
                        max_tokens: 1500
                    })
                });
                
                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // Parse JSON from response
                const jsonMatch = content.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (e) {
                console.log("API failed, using demo data");
            }
            
            // Fallback demo data
            return getDemoData(topic);
        }
        
        function getDemoData(topic) {
            // Demo fallback data
            return {
                explanation: `Let's learn about ${topic}! This is a fun interactive way to understand the concept through questions and challenges.`,
                questions: [
                    {
                        question: `What is the main idea behind ${topic}?`,
                        options: ["Understanding basics", "Memorizing facts", "Skipping learning", "Guessing answers"],
                        correct: 0,
                        explanation: "Understanding the basics is the foundation of learning any concept!"
                    },
                    {
                        question: `Why is ${topic} important to learn?`,
                        options: ["It's not important", "Helps in real life", "Only for tests", "Teachers say so"],
                        correct: 1,
                        explanation: "Learning helps us apply knowledge in real-life situations!"
                    },
                    {
                        question: "What's the best way to learn something new?",
                        options: ["Give up quickly", "Practice regularly", "Never ask questions", "Avoid mistakes"],
                        correct: 1,
                        explanation: "Regular practice is the key to mastering any skill!"
                    },
                    {
                        question: "How should you handle a difficult concept?",
                        options: ["Skip it forever", "Break it into smaller parts", "Complain about it", "Ignore it"],
                        correct: 1,
                        explanation: "Breaking complex topics into smaller parts makes them easier to understand!"
                    },
                    {
                        question: "What makes learning fun?",
                        options: ["Boring lectures", "Interactive games", "Long tests", "No breaks"],
                        correct: 1,
                        explanation: "Interactive games and activities make learning enjoyable and memorable!"
                    }
                ]
            };
        }
        
        function showQuestion() {
            const q = gameData.questions[currentQ];
            document.getElementById('q-num').textContent = `${currentQ + 1}/${gameData.questions.length}`;
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = `${streak}üî•`;
            document.getElementById('question-text').textContent = q.question;
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(i);
                optionsContainer.appendChild(btn);
            });
            
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('next-btn').className = 'next-btn';
        }
        
        function checkAnswer(selected) {
            const q = gameData.questions[currentQ];
            const buttons = document.querySelectorAll('.option-btn');
            const feedback = document.getElementById('feedback');
            
            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) btn.classList.add('correct');
                if (i === selected && i !== q.correct) btn.classList.add('wrong');
            });
            
            if (selected === q.correct) {
                score++;
                streak++;
                feedback.textContent = `‚úÖ Correct! ${q.explanation}`;
                feedback.className = 'feedback show correct';
            } else {
                streak = 0;
                feedback.textContent = `‚ùå Not quite. ${q.explanation}`;
                feedback.className = 'feedback show wrong';
            }
            
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = `${streak}üî•`;
            document.getElementById('next-btn').className = 'next-btn show';
        }
        
        function nextQuestion() {
            currentQ++;
            if (currentQ < gameData.questions.length) {
                showQuestion();
            } else {
                endGame();
            }
        }
        
        function endGame() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            document.getElementById('final-score').textContent = `${score}/${gameData.questions.length}`;
            
            const percent = (score / gameData.questions.length) * 100;
            let msg = percent === 100 ? "üèÜ Perfect! You're a master!" :
                      percent >= 80 ? "üåü Excellent work!" :
                      percent >= 60 ? "üëç Good job! Keep practicing!" :
                      "üí™ Keep learning, you'll get better!";
            document.getElementById('result-message').textContent = msg;
        }
        
        function resetGame() {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('setup-screen').style.display = 'block';
            document.getElementById('topic-input').value = '';
            gameData = null;
        }
    </script>
</body>
                  </html>
